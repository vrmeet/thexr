const fs = require('fs')
const { couldStartTrivia } = require('typescript')

const sourceFilePath = './js/event-names.ts'
const targetFilePath = "../lib/event_name.ex"

fs.watch(sourceFilePath, () => {
    console.log('file changed')
    fs.readFile(sourceFilePath, 'utf8', (err, data) => {
        if (err) {
            console.error(err);
            return;
        }
        // just the data between { and } of the 'enum'
        const events = data.substring(
            data.indexOf("{") + 1,
            data.lastIndexOf("}")
        ).split(',')
            .map(event => {
                return event.replace(/[^a-z_]/g, '')
            })

        const functions = events.map((event, index) => {
            return `  def ${event}, do: ${index + 1}`
        })
        let newContent = `
# UPDATE event-names.ts INSTEAD OF THIS FILE
# THIS FILE IS AUTOGENERATED, DO NOT MANUALLY UPDATE
#
defmodule EventName do

${functions.join("\n")}

end
        `
        console.log(newContent)
        fs.writeFileSync(targetFilePath, newContent, { mode: 0o644 })
    });


})